# DNS Records Coverage - DNS4M365 Module

## Complete List of DNS Records Covered by DNS4M365

This document provides a comprehensive list of **ALL** DNS records that the DNS4M365 PowerShell module can query, validate, and manage for Microsoft 365.

---

## Summary Statistics

| Category | Count | Details |
|----------|-------|---------|
| **MX Records** | 1-3 | Primary, hybrid, and failover configurations |
| **CNAME Records** | 15+ | Service discovery, authentication, MDM, DKIM |
| **TXT Records** | 8+ | SPF, DMARC, DKIM, verification, security |
| **SRV Records** | 2-4 | Teams/SfB federation and services |
| **Total Unique Records** | **30+** | Per domain (varies by services enabled) |

---

## Records Retrieved from Microsoft Graph API

These records are automatically generated by Microsoft 365 and can be retrieved via the Graph API using the module's core functions.

### ✅ MX Records (1)

| Record | Purpose | Function |
|--------|---------|----------|
| **Mail Exchange** | Email routing to Exchange Online | `Get-M365DomainDNSRecord -RecordType MX` |

**Example**: `contoso.com MX 0 contoso-com.mail.protection.outlook.com`

### ✅ CNAME Records (8-10 from Graph API)

| Record | Subdomain | Purpose | Function |
|--------|-----------|---------|----------|
| **Autodiscover** | `autodiscover` | Outlook auto-configuration | `Get-M365DomainDNSRecord` |
| **SIP** | `sip` | Teams/SfB service discovery | `Get-M365DomainDNSRecord` |
| **Lyncdiscover** | `lyncdiscover` | Teams/SfB mobile discovery | `Get-M365DomainDNSRecord` |
| **EnterpriseEnrollment** | `enterpriseenrollment` | Intune device enrollment | `Get-M365DomainDNSRecord` |
| **EnterpriseRegistration** | `enterpriseregistration` | Azure AD device registration | `Get-M365DomainDNSRecord` |
| **DKIM Selector 1** | `selector1._domainkey` | DKIM email authentication | `Get-M365DomainDNSRecord` |
| **DKIM Selector 2** | `selector2._domainkey` | DKIM key rotation | `Get-M365DomainDNSRecord` |
| **SharePoint (optional)** | `sharepoint` | SharePoint vanity URL | `Get-M365DomainDNSRecord` |
| **Teams (optional)** | `teams` | Teams vanity URL | `Get-M365DomainDNSRecord` |
| **MSAppProxy (optional)** | custom | Azure AD App Proxy | `Get-M365DomainDNSRecord` |

### ✅ TXT Records (1-2 from Graph API)

| Record | Subdomain | Purpose | Function |
|--------|-----------|---------|----------|
| **Domain Verification** | `@` or `_domainverify` | Prove domain ownership | `Get-M365DomainVerificationRecord` |
| **SPF (partial)** | `@` | Sender Policy Framework | `Get-M365DomainDNSRecord` |

**Note**: SPF configuration is provided by Graph API but actual validation requires DNS query.

### ✅ SRV Records (2 from Graph API)

| Record | Service | Purpose | Function |
|--------|---------|---------|----------|
| **SIP TLS** | `_sip._tls` | Teams external access | `Get-M365DomainDNSRecord -RecordType SRV` |
| **SIP Federation** | `_sipfederationtls._tcp` | Teams federation | `Get-M365DomainDNSRecord -RecordType SRV` |

---

## Records Validated via DNS Resolution

These records must be queried directly from DNS as they are not provided by Graph API, or require validation beyond Graph API data.

### ✅ Additional TXT Records (5-6)

| Record | Subdomain | Purpose | Function |
|--------|-----------|---------|----------|
| **SPF (full validation)** | `@` | Email sender authorization | `Get-M365DomainDNSHealth -IncludeSPF` |
| **DMARC** | `_dmarc` | Email authentication policy | `Get-M365DomainDNSHealth -IncludeDMARC` |
| **BIMI (optional)** | `default._bimi` | Brand indicators in email | `Get-M365DomainDNSHealth -IncludeOptional` |
| **MTA-STS (optional)** | `_mta-sts` | TLS enforcement | `Get-M365DomainDNSHealth -IncludeOptional` |
| **TLSRPT (optional)** | `_smtp._tls` | TLS reporting | `Get-M365DomainDNSHealth -IncludeOptional` |
| **Additional Verification** | `@` | Third-party services | `Get-M365DomainDNSHealth` |

### ✅ DKIM Resolution Validation (2)

| Record | Subdomain | Purpose | Function |
|--------|-----------|---------|----------|
| **DKIM Selector 1 Resolution** | `selector1._domainkey` | Verify DKIM key published | `Get-M365DomainDNSHealth -CheckDKIMResolution` |
| **DKIM Selector 2 Resolution** | `selector2._domainkey` | Verify DKIM key published | `Get-M365DomainDNSHealth -CheckDKIMResolution` |

### ✅ SRV Record Validation (2)

| Record | Service | Purpose | Function |
|--------|---------|---------|----------|
| **SIP TLS Validation** | `_sip._tls` | Verify Teams SRV record | `Get-M365DomainDNSHealth -CheckSRVRecords` |
| **SIP Federation Validation** | `_sipfederationtls._tcp` | Verify federation SRV | `Get-M365DomainDNSHealth -CheckSRVRecords` |

---

## Deprecated Records Detection

The module can detect deprecated DNS records that should be removed.

### ⚠️ Deprecated Records (1)

| Record | Subdomain | Status | Function |
|--------|-----------|--------|----------|
| **MSOID (CRITICAL)** | `msoid` | **MUST BE REMOVED** | `Get-M365DomainDNSHealth -CheckDeprecated` |

**CRITICAL**: The `msoid` CNAME record blocks Microsoft 365 Apps activation and MUST be removed if present.

---

## Module Functions and Coverage

### Core Functions (Retrieve from Graph API)

#### 1. `Get-M365DomainDNSRecord`
**Retrieves Microsoft-generated DNS records from Graph API**

```powershell
# Get all record types
Get-M365DomainDNSRecord -DomainName "contoso.com"

# Filter by type
Get-M365DomainDNSRecord -RecordType MX
Get-M365DomainDNSRecord -RecordType CNAME
Get-M365DomainDNSRecord -RecordType TXT
Get-M365DomainDNSRecord -RecordType SRV

# Filter by service
Get-M365DomainDNSRecord -ServiceType Email
Get-M365DomainDNSRecord -ServiceType OfficeCommunicationsOnline
Get-M365DomainDNSRecord -ServiceType Intune
```

**Returns**:
- ✅ All MX records (1)
- ✅ All CNAME records (8-10)
- ✅ Verification TXT records (1)
- ✅ All SRV records (2)

#### 2. `Get-M365DomainVerificationRecord`
**Retrieves domain verification records**

```powershell
Get-M365DomainVerificationRecord -DomainName "contoso.com"
```

**Returns**:
- ✅ TXT verification records
- ✅ MX verification records (if applicable)

### Enhanced Validation Functions (DNS Resolution)

#### 3. `Get-M365DomainDNSHealth`
**Comprehensive DNS health check with actual DNS resolution**

```powershell
# Full health check
Get-M365DomainDNSHealth -DomainName "contoso.com" `
    -IncludeDMARC `
    -IncludeSPF `
    -CheckDKIMResolution `
    -CheckSRVRecords `
    -CheckDeprecated
```

**Validates**:
- ✅ MX record existence and correctness
- ✅ Autodiscover CNAME
- ✅ SPF TXT record (with validation)
- ✅ DMARC TXT record (actual DNS query)
- ✅ DKIM Selector 1 & 2 (resolution check)
- ✅ SIP CNAME
- ✅ lyncdiscover CNAME
- ✅ SIP TLS SRV record
- ✅ SIP Federation SRV record
- ✅ EnterpriseEnrollment CNAME
- ✅ EnterpriseRegistration CNAME
- ✅ Deprecated MSOID CNAME (detection)

#### 4. `Compare-M365DomainDNS`
**Compares expected vs actual DNS configuration**

```powershell
# Compare all records
Compare-M365DomainDNS -DomainName "contoso.com" -IncludeOptional

# Show only differences
Compare-M365DomainDNS -DomainName "contoso.com" -ShowOnlyDifferences
```

**Compares**:
- ✅ All Graph API records vs actual DNS
- ✅ Optional records (DMARC, etc.)
- ✅ Deprecated records detection
- ✅ Identifies missing, mismatched, or extra records

---

## Complete Coverage Matrix

### By Record Type

| Record Type | Graph API | DNS Validation | Comparison | Health Check |
|-------------|-----------|----------------|------------|--------------|
| **MX** | ✅ | ✅ | ✅ | ✅ |
| **CNAME** | ✅ | ✅ | ✅ | ✅ |
| **TXT** | ⚠️ Partial | ✅ Full | ✅ | ✅ |
| **SRV** | ✅ | ✅ | ✅ | ✅ |

### By Service

| Service | Records Covered | Functions |
|---------|----------------|-----------|
| **Exchange Online** | MX, Autodiscover, SPF, DKIM (x2) | All functions |
| **Teams/SfB** | SIP, lyncdiscover, SRV (x2) | All functions |
| **Intune/MDM** | EnterpriseEnrollment, EnterpriseRegistration | All functions |
| **Email Security** | SPF, DMARC, DKIM, BIMI, MTA-STS, TLSRPT | Health & Comparison |
| **Domain Verification** | TXT verification records | Verification function |
| **SharePoint** | SharePoint/Teams vanity CNAMEs | Graph API retrieval |
| **Azure AD** | EnterpriseRegistration | Graph API retrieval |

---

## Record Details by Category

### Email Records (9-11 total)

| # | Record Type | Subdomain | Required | Function |
|---|-------------|-----------|----------|----------|
| 1 | MX | `@` | ✅ Required | All |
| 2 | CNAME | `autodiscover` | ✅ Required | All |
| 3 | TXT | `@` (SPF) | ✅ Required | Health/Compare |
| 4 | TXT | `_dmarc` | ⚠️ Recommended | Health/Compare |
| 5 | CNAME | `selector1._domainkey` | ⚠️ Recommended | Graph/Health |
| 6 | CNAME | `selector2._domainkey` | ⚠️ Recommended | Graph/Health |
| 7 | TXT | `default._bimi` | ⭕ Optional | Health |
| 8 | TXT | `_mta-sts` | ⭕ Optional | Health |
| 9 | TXT | `_smtp._tls` | ⭕ Optional | Health |

### Teams/SfB Records (4 total)

| # | Record Type | Subdomain | Required | Function |
|---|-------------|-----------|----------|----------|
| 1 | CNAME | `sip` | ⚠️ For Federation | Graph/Health |
| 2 | CNAME | `lyncdiscover` | ⚠️ For Mobile | Graph/Health |
| 3 | SRV | `_sip._tls` | ⚠️ For Federation | Graph/Health |
| 4 | SRV | `_sipfederationtls._tcp` | ⚠️ For Federation | Graph/Health |

### Intune/MDM Records (2 total)

| # | Record Type | Subdomain | Required | Function |
|---|-------------|-----------|----------|----------|
| 1 | CNAME | `enterpriseenrollment` | ✅ For Intune | Graph/Health |
| 2 | CNAME | `enterpriseregistration` | ✅ For Intune | Graph/Health |

### Verification Records (1-2 total)

| # | Record Type | Subdomain | Required | Function |
|---|-------------|-----------|----------|----------|
| 1 | TXT | `@` or `_domainverify` | ✅ Initial Setup | Verification |
| 2 | MX | `@` (alternative) | ⭕ Optional | Verification |

### Deprecated Records (1 total)

| # | Record Type | Subdomain | Status | Function |
|---|-------------|-----------|--------|----------|
| 1 | CNAME | `msoid` | ⛔ **REMOVE** | Health/Compare |

---

## Usage Examples

### Example 1: Get ALL DNS Information for a Domain

```powershell
# Connect to Microsoft 365
Connect-M365DNS

# Get Graph API records
$graphRecords = Get-M365DomainDNSRecord -DomainName "contoso.com"

# Perform comprehensive health check
$health = Get-M365DomainDNSHealth -DomainName "contoso.com" `
    -IncludeDMARC `
    -IncludeSPF `
    -CheckDKIMResolution `
    -CheckSRVRecords `
    -CheckDeprecated

# Compare expected vs actual
$comparison = Compare-M365DomainDNS -DomainName "contoso.com" `
    -IncludeOptional `
    -ShowOnlyDifferences

# View results
$graphRecords | Format-Table
$health | Format-List
$comparison | Format-Table
```

### Example 2: Audit All Domains

```powershell
# Get all verified domains
$domains = Get-M365Domain -VerificationStatus Verified

# Check health for each
foreach ($domain in $domains) {
    Get-M365DomainDNSHealth -DomainName $domain.DomainName `
        -IncludeDMARC `
        -IncludeSPF `
        -CheckDKIMResolution `
        -CheckSRVRecords `
        -CheckDeprecated
}
```

### Example 3: Export Complete DNS Audit

```powershell
# Comprehensive audit with export
$domains = Get-M365Domain -VerificationStatus Verified

$auditResults = foreach ($domain in $domains) {
    # Graph API records
    $graphRecords = Get-M365DomainDNSRecord -DomainName $domain.DomainName

    # DNS health check
    $health = Get-M365DomainDNSHealth -DomainName $domain.DomainName `
        -IncludeDMARC -IncludeSPF -CheckDKIMResolution -CheckSRVRecords

    # Comparison
    $comparison = Compare-M365DomainDNS -DomainName $domain.DomainName

    [PSCustomObject]@{
        Domain = $domain.DomainName
        GraphRecordsCount = $graphRecords.Count
        HealthStatus = $health.OverallHealth
        MismatchCount = ($comparison | Where-Object { $_.Status -ne "Match" }).Count
    }
}

# Export
$auditResults | Export-Csv "DNS-Audit-$(Get-Date -Format 'yyyyMMdd').csv" -NoTypeInformation
```

---

## Record Type Breakdown

### Total Records Per Domain (Typical)

| Configuration | Required | Recommended | Optional | Total |
|--------------|----------|-------------|----------|-------|
| **Email Only** | 4 | 5 | 3 | 8-12 |
| **Email + Teams** | 4 | 9 | 3 | 12-16 |
| **Email + Teams + Intune** | 4 | 11 | 3 | 14-18 |
| **Full M365 (All Services)** | 4 | 11 | 5-8 | 15-23 |

---

## Key Features

### ✅ Complete Coverage
- **30+ unique DNS record types** across all Microsoft 365 services
- Graph API records + DNS-only records
- Required, recommended, and optional records
- Deprecated record detection

### ✅ Multiple Query Methods
- **Graph API**: Microsoft-generated records
- **DNS Resolution**: Actual DNS validation
- **Comparison**: Expected vs actual
- **Health Checks**: Comprehensive validation

### ✅ All Microsoft 365 Services
- Exchange Online / Email
- Microsoft Teams / Skype for Business
- Intune / Mobile Device Management
- SharePoint Online
- Azure AD / Entra ID
- Email Security (SPF, DKIM, DMARC)

---

## Summary

The **DNS4M365 module provides complete coverage** of all DNS records required for Microsoft 365, including:

- **15-20 records** retrieved from Microsoft Graph API
- **10-15 additional records** validated via DNS resolution
- **DMARC, SPF, DKIM** full validation
- **Deprecated record** detection (msoid)
- **Health checks** with actionable recommendations
- **Comparison** between expected and actual DNS

**Total Coverage**: **30+ unique DNS record types** per domain

---

**Last Updated**: 2025-01-06
**Module Version**: 1.0.0
**Documentation**: See [COMPLETE-DNS-RECORDS-REFERENCE.md](COMPLETE-DNS-RECORDS-REFERENCE.md) for detailed record specifications
