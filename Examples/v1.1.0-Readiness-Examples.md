# DNS4M365 v1.1.0 - DNS Readiness & Compliance Examples

This document contains realistic examples demonstrating the v1.1.0 DNS compliance assessment features. The same function (`Get-M365DomainReadiness`) serves multiple purposes:
- **Ongoing Compliance Auditing**: Regular validation against current best practices
- **Security Posture Assessment**: Email authentication and deprecated record detection
- **Configuration Validation**: Format compliance checking (MX, DKIM, etc.)
- **Change Planning**: Understanding impact before making DNS changes

---

## Example 1: Basic DNS Compliance Check

### Command
```powershell
Get-M365DomainReadiness -DomainName "contoso.com" -ShowRecommendations
```

### Output
```
Assessing DNS readiness for: contoso.com

  Overall Readiness: 40%
  Action Priority: CRITICAL
  MX Format: mail.protection.outlook.com (legacy)
  DKIM Format: Not Configured
  Email Auth Status: Not Ready

  Critical Actions Required:
    - Update MX record to mx.microsoft format (current best practice)
    - CRITICAL: No SPF record found - MANDATORY for email authentication (April 2025)
    - CRITICAL: No DMARC record found - MANDATORY with policy p=quarantine or p=reject (April 2025)
    - CRITICAL: Remove msoid.contoso.com CNAME - BLOCKS Microsoft 365 Apps activation

  Recommendations:
    - Configure DKIM signing for improved email authentication
```

**Use Case:** Identified critical compliance gap during routine audit. Email authentication missing and deprecated record present.

### Returned Object
```powershell
Domain                  : contoso.com
OverallReadiness        : 40
MXStatus                : Legacy
MXFormat                : mail.protection.outlook.com (legacy)
UsingLegacyMX           : True
DKIMStatus              : Not Configured
DKIMFormat              : Unknown
UsingLegacyDKIM         : False
EmailAuthStatus         : Not Ready
SPFConfigured           : False
DMARCConfigured         : False
EmailAuthReady          : False
DeprecatedRecords       : {msoid.contoso.com}
LegacyTeamsRecords      : {}
CriticalActions         : {4 items}
Recommendations         : {1 item}
ActionPriority          : CRITICAL
```

---

## Example 2: Compliance Check - Partial Compliance

### Command
```powershell
Get-M365DomainReadiness -DomainName "fabrikam.com" -ShowRecommendations
```

### Output
```
Assessing DNS readiness for: fabrikam.com

  Overall Readiness: 60%
  Action Priority: High
  MX Format: mail.protection.outlook.com (legacy)
  DKIM Format: onmicrosoft.com (legacy)
  Email Auth Status: Ready

  Critical Actions Required:
    - Update MX record to mx.microsoft format (current best practice)

  Recommendations:
    - DKIM using legacy format - new deployments use dkim.mail.microsoft format (May 2025+)
    - DMARC policy is 'none' - upgrade to 'quarantine' or 'reject' for April 2025 compliance

  Legacy Teams/Skype Records:
    - sip.fabrikam.com CNAME
    - lyncdiscover.fabrikam.com CNAME
    - _sip._tls.fabrikam.com SRV
```

**Use Case:** Compliance audit reveals email authentication is configured but using weak DMARC policy. Legacy formats detected but not critical.

### Returned Object
```powershell
Domain                  : fabrikam.com
OverallReadiness        : 60
ActionPriority          : High
MXFormat                : mail.protection.outlook.com (legacy)
UsingLegacyMX           : True
DKIMFormat              : onmicrosoft.com (legacy)
UsingLegacyDKIM         : True
EmailAuthReady          : True
DeprecatedRecords       : {}
LegacyTeamsRecords      : {sip.fabrikam.com CNAME, lyncdiscover.fabrikam.com CNAME, _sip._tls.fabrikam.com SRV}
```

---

## Example 3: Compliance Check - Fully Compliant Domain

### Command
```powershell
Get-M365DomainReadiness -DomainName "moderncompany.com"
```

### Output
```
Assessing DNS readiness for: moderncompany.com

  Overall Readiness: 100%
  Action Priority: Low
  MX Format: mx.microsoft (current)
  DKIM Format: dkim.mail.microsoft (current)
  Email Auth Status: Ready
```

**Use Case:** Validation that new domain is configured according to current best practices. Clean bill of health.

---

## Example 4: Tenant-Wide Compliance Audit with Export

### Command
```powershell
Get-M365DomainReadiness -ExportReport -OutputPath "C:\Audits"
```

### Output
```
Assessing DNS readiness for: contoso.com
  Overall Readiness: 40%
  Action Priority: CRITICAL
  [... details ...]

Assessing DNS readiness for: fabrikam.com
  Overall Readiness: 60%
  Action Priority: High
  [... details ...]

Assessing DNS readiness for: moderncompany.com
  Overall Readiness: 100%
  Action Priority: Low

Assessing DNS readiness for: adventureworks.com
  Overall Readiness: 80%
  Action Priority: Medium

DNS readiness report exported to: C:\Audits\M365-DNS-Readiness-20250106-143022.csv

=== DNS Readiness Summary ===
Total Domains Assessed: 4
Average Readiness: 70%
CRITICAL Priority: 1
High Priority: 1
```

**Use Case:** Monthly compliance audit across all tenant domains with exported report for management review.

### CSV Export Sample
```csv
Domain,OverallReadiness,ActionPriority,MXStatus,MXFormat,DKIMStatus,DKIMFormat,EmailAuthStatus,SPFConfigured,DMARCConfigured,CriticalActionsCount,DeprecatedRecordsCount,LegacyRecordsCount
contoso.com,40,CRITICAL,Legacy,mail.protection.outlook.com (legacy),Not Configured,Unknown,Not Ready,False,False,4,1,0
fabrikam.com,60,High,Legacy,mail.protection.outlook.com (legacy),Legacy,onmicrosoft.com (legacy),Ready,True,True,1,0,3
moderncompany.com,100,Low,Modern,mx.microsoft (current),Modern,dkim.mail.microsoft (current),Ready,True,True,0,0,0
adventureworks.com,80,Medium,Modern,mx.microsoft (current),Legacy,onmicrosoft.com (legacy),Ready,True,True,0,0,0
```

---

## Example 5: Security Compliance Dashboard

### Command
```powershell
# Get all domain assessments
$allDomains = Get-M365DomainReadiness

# Calculate security posture statistics
$stats = @{
    TotalDomains = $allDomains.Count
    AvgCompliance = [math]::Round(($allDomains | Measure-Object -Property OverallReadiness -Average).Average, 0)
    CriticalCount = ($allDomains | Where-Object { $_.ActionPriority -eq "CRITICAL" }).Count
    HighCount = ($allDomains | Where-Object { $_.ActionPriority -eq "High" }).Count
    MediumCount = ($allDomains | Where-Object { $_.ActionPriority -eq "Medium" }).Count
    CompliantCount = ($allDomains | Where-Object { $_.ActionPriority -eq "Low" }).Count
    NoEmailAuth = ($allDomains | Where-Object { $_.EmailAuthReady -eq $false }).Count
    WithDeprecated = ($allDomains | Where-Object { $_.DeprecatedRecords.Count -gt 0 }).Count
    UsingModernMX = ($allDomains | Where-Object { $_.MXStatus -eq "Modern" }).Count
    UsingModernDKIM = ($allDomains | Where-Object { $_.DKIMStatus -eq "Modern" }).Count
}

# Display compliance dashboard
Write-Host "`n╔════════════════════════════════════════════════════════╗" -ForegroundColor Cyan
Write-Host "║  Microsoft 365 DNS Compliance Dashboard               ║" -ForegroundColor Cyan
Write-Host "╚════════════════════════════════════════════════════════╝" -ForegroundColor Cyan

Write-Host "`nOverall Statistics:" -ForegroundColor White
Write-Host "  Total Domains: $($stats.TotalDomains)" -ForegroundColor White
Write-Host "  Average Compliance: $($stats.AvgCompliance)%" -ForegroundColor $(
    if ($stats.AvgCompliance -ge 80) { "Green" }
    elseif ($stats.AvgCompliance -ge 60) { "Yellow" }
    else { "Red" }
)

Write-Host "`nAction Priority:" -ForegroundColor White
Write-Host "  CRITICAL: $($stats.CriticalCount)" -ForegroundColor Red
Write-Host "  High: $($stats.HighCount)" -ForegroundColor Magenta
Write-Host "  Medium: $($stats.MediumCount)" -ForegroundColor Yellow
Write-Host "  Compliant: $($stats.CompliantCount)" -ForegroundColor Green

Write-Host "`nSecurity Posture:" -ForegroundColor White
Write-Host "  Missing Email Auth: $($stats.NoEmailAuth)" -ForegroundColor Red
Write-Host "  Deprecated Records: $($stats.WithDeprecated)" -ForegroundColor Red
Write-Host "  Using Modern MX: $($stats.UsingModernMX)/$($stats.TotalDomains)" -ForegroundColor Green
Write-Host "  Using Modern DKIM: $($stats.UsingModernDKIM)/$($stats.TotalDomains)" -ForegroundColor Green
```

### Output
```
╔════════════════════════════════════════════════════════╗
║  Microsoft 365 DNS Compliance Dashboard               ║
╚════════════════════════════════════════════════════════╝

Overall Statistics:
  Total Domains: 12
  Average Compliance: 68%

Action Priority:
  CRITICAL: 3
  High: 4
  Medium: 3
  Compliant: 2

Security Posture:
  Missing Email Auth: 3
  Deprecated Records: 2
  Using Modern MX: 5/12
  Using Modern DKIM: 4/12
```

**Use Case:** Executive dashboard showing organization-wide DNS compliance posture for security review.

---

## Example 6: Pre-Change Validation

### Command
```powershell
# Before making any DNS changes, assess current state
Write-Host "=== PRE-CHANGE ASSESSMENT ===" -ForegroundColor Cyan
$beforeState = Get-M365DomainReadiness -DomainName "planning.contoso.com"

# Display what needs to change
Write-Host "`nCurrent State:" -ForegroundColor Yellow
Write-Host "  Compliance Score: $($beforeState.OverallReadiness)%"
Write-Host "  MX Format: $($beforeState.MXFormat)"
Write-Host "  DKIM Format: $($beforeState.DKIMFormat)"
Write-Host "  Email Auth: $($beforeState.EmailAuthStatus)"

Write-Host "`nPlanned Changes:" -ForegroundColor Green
if ($beforeState.UsingLegacyMX) {
    Write-Host "  ✓ Update MX to mx.microsoft format"
}
if ($beforeState.UsingLegacyDKIM) {
    Write-Host "  ✓ Update DKIM selectors to dkim.mail.microsoft"
}
if (-not $beforeState.EmailAuthReady) {
    Write-Host "  ✓ Configure SPF and DMARC records"
}
if ($beforeState.DeprecatedRecords.Count -gt 0) {
    Write-Host "  ✓ Remove deprecated records: $($beforeState.DeprecatedRecords -join ', ')"
}

Write-Host "`nExpected Post-Change Compliance: ~100%" -ForegroundColor Green
```

**Use Case:** Planning DNS updates by understanding current state and gap to full compliance. Same tool used for both audit and planning.

---

## Example 7: Continuous Monitoring Script

### Command
```powershell
# Monthly compliance monitoring script
param(
    [string]$ReportPath = "C:\Compliance\Monthly",
    [string]$EmailTo = "it-team@contoso.com"
)

# Run compliance assessment
$assessment = Get-M365DomainReadiness -ExportReport -OutputPath $ReportPath

# Filter domains needing attention
$criticalDomains = $assessment | Where-Object { $_.ActionPriority -eq "CRITICAL" }
$highPriorityDomains = $assessment | Where-Object { $_.ActionPriority -eq "High" }

# Create alert if issues found
if ($criticalDomains.Count -gt 0 -or $highPriorityDomains.Count -gt 0) {
    $alertMessage = @"
DNS Compliance Alert - $(Get-Date -Format 'yyyy-MM-dd')

CRITICAL Issues: $($criticalDomains.Count) domains
High Priority: $($highPriorityDomains.Count) domains

Critical Domains:
$($criticalDomains | ForEach-Object { "- $($_.Domain): $($_.CriticalActions.Count) actions required" } | Out-String)

High Priority Domains:
$($highPriorityDomains | ForEach-Object { "- $($_.Domain): $($_.MXFormat), $($_.DKIMFormat)" } | Out-String)

Full report: $ReportPath
"@

    # Send email alert (requires mail configuration)
    # Send-MailMessage -To $EmailTo -Subject "DNS Compliance Alert" -Body $alertMessage

    Write-Host $alertMessage -ForegroundColor Yellow
}
else {
    Write-Host "All domains compliant - no issues detected" -ForegroundColor Green
}
```

**Use Case:** Scheduled task for continuous compliance monitoring with alerting on non-compliant domains.

---

## Example 8: Government Cloud Compliance Check

### Command
```powershell
Get-M365DomainReadiness -DomainName "agency.gov" -ShowRecommendations
```

### Output
```
Assessing DNS readiness for: agency.gov

  Overall Readiness: 80%
  Action Priority: Medium
  MX Format: office365.us (GCC/DoD)
  DKIM Format: onmicrosoft.com (legacy)
  Email Auth Status: Ready

  Recommendations:
    - DKIM using legacy format - consider updating to dkim.mail.microsoft format for new standard
```

**Use Case:** Government cloud tenant compliance validation. MX is correct for GCC/DoD, but DKIM could be modernized.

---

## Example 9: Filtering and Reporting for Specific Issues

### Command
```powershell
# Audit all domains for specific compliance issues
$allDomains = Get-M365DomainReadiness

# Domains missing email authentication (security risk)
Write-Host "`n=== EMAIL AUTHENTICATION COMPLIANCE ===" -ForegroundColor Red
$noEmailAuth = $allDomains | Where-Object { -not $_.EmailAuthReady }
$noEmailAuth | Select-Object Domain, SPFConfigured, DMARCConfigured, ActionPriority | Format-Table

# Domains with deprecated records (operational risk)
Write-Host "`n=== DEPRECATED RECORDS DETECTED ===" -ForegroundColor Magenta
$deprecated = $allDomains | Where-Object { $_.DeprecatedRecords.Count -gt 0 }
$deprecated | ForEach-Object {
    Write-Host "  $($_.Domain):" -ForegroundColor Yellow
    $_.DeprecatedRecords | ForEach-Object { Write-Host "    - $_" -ForegroundColor Red }
}

# Domains using legacy formats (upgrade opportunity)
Write-Host "`n=== LEGACY FORMAT USAGE ===" -ForegroundColor Yellow
$legacyFormats = $allDomains | Where-Object { $_.UsingLegacyMX -or $_.UsingLegacyDKIM }
$legacyFormats | Select-Object Domain, MXFormat, DKIMFormat, ActionPriority | Format-Table
```

**Use Case:** Targeted audits focusing on specific compliance areas - security, operational risk, or optimization opportunities.

---

## Example 10: Compliance Trend Tracking

### Command
```powershell
# Run monthly and compare to previous month
$currentMonth = Get-M365DomainReadiness
$currentMonth | Export-Csv -Path "C:\Compliance\2025-01-Assessment.csv" -NoTypeInformation

# Compare to previous month (if exists)
if (Test-Path "C:\Compliance\2024-12-Assessment.csv") {
    $previousMonth = Import-Csv "C:\Compliance\2024-12-Assessment.csv"

    Write-Host "`n=== COMPLIANCE TREND ANALYSIS ===" -ForegroundColor Cyan

    $currentAvg = ($currentMonth | Measure-Object -Property OverallReadiness -Average).Average
    $previousAvg = ($previousMonth | Measure-Object -Property OverallReadiness -Average).Average
    $trend = $currentAvg - $previousAvg

    Write-Host "Previous Month: $([math]::Round($previousAvg, 0))%" -ForegroundColor White
    Write-Host "Current Month:  $([math]::Round($currentAvg, 0))%" -ForegroundColor White
    Write-Host "Trend: $(if ($trend -gt 0) { '+' })$([math]::Round($trend, 0))%" -ForegroundColor $(
        if ($trend -gt 0) { "Green" } else { "Red" }
    )

    # Identify improved domains
    $improvements = @()
    foreach ($current in $currentMonth) {
        $previous = $previousMonth | Where-Object { $_.Domain -eq $current.Domain }
        if ($previous -and $current.OverallReadiness -gt $previous.OverallReadiness) {
            $improvements += [PSCustomObject]@{
                Domain = $current.Domain
                PreviousScore = $previous.OverallReadiness
                CurrentScore = $current.OverallReadiness
                Improvement = $current.OverallReadiness - $previous.OverallReadiness
            }
        }
    }

    if ($improvements.Count -gt 0) {
        Write-Host "`nImproved Domains:" -ForegroundColor Green
        $improvements | Format-Table
    }
}
```

**Use Case:** Track DNS compliance trends over time to measure effectiveness of remediation efforts.

---

## Summary

The `Get-M365DomainReadiness` function is a general-purpose DNS compliance and validation tool that supports:

### Audit Use Cases
- **Ongoing Compliance Monitoring**: Regular assessments against current best practices
- **Security Audits**: Email authentication and deprecated record detection
- **Executive Reporting**: Compliance scoring and dashboards
- **Trend Analysis**: Month-over-month compliance tracking

### Operational Use Cases
- **Configuration Validation**: Verify DNS is configured correctly
- **Pre-Change Assessment**: Understand current state before making changes
- **Post-Change Validation**: Confirm changes were applied correctly
- **Troubleshooting**: Identify DNS configuration issues

### Planning Use Cases
- **Change Impact Analysis**: Understand what needs to change
- **Upgrade Planning**: Identify domains using legacy formats
- **Risk Assessment**: Prioritize remediation based on ActionPriority

The same data serves all use cases - whether you're auditing for compliance, planning changes, or migrating to new formats.

## Key Metrics Explained

| Metric | Meaning | Values |
|--------|---------|--------|
| **OverallReadiness** | DNS compliance score | 0-100% |
| **ActionPriority** | Required action urgency | CRITICAL, High, Medium, Low |
| **MXFormat** | MX record configuration | Modern, Legacy, Gov Cloud |
| **DKIMFormat** | DKIM configuration | Modern, Legacy, Not Configured |
| **EmailAuthStatus** | SPF + DMARC status | Ready, Partial, Not Ready |
| **UsingLegacyMX** | Using older MX format | True/False |
| **UsingLegacyDKIM** | Using older DKIM format | True/False |
| **DeprecatedRecords** | Records that must be removed | Array of record names |
| **LegacyTeamsRecords** | Optional cleanup opportunities | Array of record names |

All examples use realistic data to demonstrate practical usage scenarios for DNS compliance assessment and validation.
